const fs = require('fs');

const filePathJson = '.\output/\server/\package.json';
const filePath = '.\output/\server/\chunks/nitro/node-server.mjs';
const jsonDataJson = JSON.parse(fs.readFileSync(filePathJson, 'utf8'));
const jsonData = JSON.parse(JSON.stringify(fs.readFileSync(filePath, 'utf8')));
const newLineToAdd = "import * as dotenv from 'dotenv';dotenv.config()";



// Modify the data as needed
jsonDataJson.bundledDependencies = {
    "@babel/parser": "7.22.7",
    "@babel/runtime": "7.22.11",
    "@mapbox/node-pre-gyp": "1.0.11",
    "@npmcli/fs": "3.1.0",
    "@panva/hkdf": "1.1.1",
    "@phc/format": "1.0.0",
    "@tootallnate/once": "2.0.0",
    "@vue/compiler-core": "3.3.4",
    "@vue/compiler-dom": "3.3.4",
    "@vue/compiler-ssr": "3.3.4",
    "@vue/reactivity": "3.3.4",
    "@vue/runtime-core": "3.3.4",
    "@vue/runtime-dom": "3.3.4",
    "@vue/server-renderer": "3.3.4",
    "@vue/shared": "3.3.4",
    "abbrev": "1.1.1",
    "agent-base": "6.0.2",
    "agentkeepalive": "4.3.0",
    "aggregate-error": "3.1.0",
    "ansi-regex": "5.0.1",
    "aproba": "2.0.0",
    "are-we-there-yet": "2.0.0 || 3.0.1",
    "argon2": "0.30.3",
    "balanced-match": "1.0.2",
    "brace-expansion": "1.1.11 || 2.0.1",
    "buffer-from": "1.1.2",
    "cacache": "17.1.3",
    "chownr": "2.0.0",
    "clean-stack": "2.2.0",
    "color-support": "1.1.3",
    "concat-map": "0.0.1",
    "console-control-strings": "1.1.0",
    "cookie": "0.5.0",
    "cookie-es": "1.0.0",
    "dayjs": "1.11.9",
    "debug": "4.3.4",
    "defu": "6.1.2",
    "delegates": "1.0.0",
    "depd": "2.0.0",
    "destr": "2.0.0 || 2.0.1",
    "detect-libc": "2.0.2",
    "devalue": "4.3.2",
    "emoji-regex": "8.0.0",
    "encoding": "0.1.13",
    "env-paths": "2.2.1",
    "err-code": "2.0.3",
    "estree-walker": "2.0.2",
    "exponential-backoff": "3.1.1",
    "fs-minipass": "2.1.0 || 3.0.2",
    "fs.realpath": "1.0.0",
    "gauge": "3.0.2 || 4.0.4",
    "glob": "7.2.3 || 10.3.3",
    "graceful-fs": "4.2.11",
    "h3": "1.7.1 || 1.8.1 || 1.8.0",
    "has-flag": "3.0.0",
    "has-unicode": "2.0.1",
    "hookable": "5.5.3",
    "http-cache-semantics": "4.1.1",
    "http-graceful-shutdown": "3.1.13",
    "http-proxy-agent": "5.0.0",
    "https-proxy-agent": "5.0.1",
    "humanize-ms": "1.2.1",
    "iconv-lite": "0.6.3",
    "imurmurhash": "0.1.4",
    "indent-string": "4.0.0",
    "inflight": "1.0.6",
    "inherits": "2.0.4",
    "ip": "2.0.0",
    "iron-webcrypto": "0.7.1 || 0.8.0",
    "is-fullwidth-code-point": "3.0.0",
    "is-lambda": "1.0.1",
    "isexe": "2.0.0",
    "jose": "4.14.4",
    "klona": "2.0.6",
    "lru-cache": "6.0.0 || 7.18.3 || 10.0.0",
    "make-dir": "3.1.0",
    "make-fetch-happen": "11.1.1",
    "minimatch": "3.1.2 || 9.0.3",
    "minipass": "5.0.0 || 3.3.6 || 7.0.2",
    "minipass-collect": "1.0.2",
    "minipass-fetch": "3.0.3",
    "minipass-flush": "1.0.5",
    "minipass-pipeline": "1.2.4",
    "minipass-sized": "1.0.3",
    "minizlib": "2.1.2",
    "mkdirp": "1.0.4",
    "ms": "2.1.2 || 2.1.3",
    "nanoid": "3.3.6",
    "negotiator": "0.6.3",
    "next-auth": "4.21.1",
    "node-fetch": "2.6.12",
    "node-fetch-native": "1.2.0",
    "node-gyp": "9.4.0",
    "nopt": "5.0.0 || 6.0.0",
    "npmlog": "5.0.1 || 6.0.2",
    "oauth": "0.9.15",
    "object-assign": "4.1.1",
    "object-hash": "2.2.0",
    "ofetch": "1.1.1",
    "ohash": "1.1.2",
    "oidc-token-hash": "5.0.3",
    "once": "1.4.0",
    "openid-client": "5.4.3",
    "p-map": "4.0.0",
    "path-is-absolute": "1.0.1",
    "path-scurry": "1.10.1",
    "pathe": "1.1.1",
    "preact": "10.17.1",
    "preact-render-to-string": "5.2.6",
    "promise-retry": "2.0.1",
    "radix3": "1.0.1 || 1.1.0",
    "readable-stream": "3.6.2",
    "requrl": "3.0.2",
    "retry": "0.12.0",
    "rimraf": "3.0.2",
    "safe-buffer": "5.2.1",
    "safer-buffer": "2.1.2",
    "scule": "1.0.0",
    "semver": "7.5.4 || 6.3.1",
    "set-blocking": "2.0.0",
    "signal-exit": "3.0.7",
    "smart-buffer": "4.2.0",
    "socks": "2.7.1",
    "socks-proxy-agent": "7.0.0",
    "source-map": "0.6.1",
    "source-map-js": "1.0.2",
    "source-map-support": "0.5.21",
    "ssri": "10.0.4",
    "string_decoder": "1.3.0",
    "string-width": "4.2.3",
    "strip-ansi": "6.0.1",
    "supports-color": "5.5.0",
    "tar": "6.1.15",
    "tr46": "0.0.3",
    "ufo": "1.1.2 || 1.2.0 || 1.3.0",
    "uncrypto": "0.1.3",
    "unenv": "1.5.2 || 1.7.4 || 1.7.1",
    "unique-filename": "3.0.0",
    "unique-slug": "4.0.0",
    "unstorage": "1.9.0 || 1.8.0",
    "util-deprecate": "1.0.2",
    "uuid": "8.3.2",
    "vue": "3.3.4",
    "vue-bundle-renderer": "1.0.3",
    "webidl-conversions": "3.0.1",
    "whatwg-url": "5.0.0",
    "which": "2.0.2",
    "wide-align": "1.1.5",
    "wrappy": "1.0.2",
    "yallist": "4.0.0"
};

jsonDataJson.dependencies =  {
    "@babel/parser": "7.22.7",
    "@babel/runtime": "7.22.11",
    "@mapbox/node-pre-gyp": "1.0.11",
    "@npmcli/fs": "3.1.0",
    "@panva/hkdf": "1.1.1",
    "@phc/format": "1.0.0",
    "@tootallnate/once": "2.0.0",
    "@vue/compiler-core": "3.3.4",
    "@vue/compiler-dom": "3.3.4",
    "@vue/compiler-ssr": "3.3.4",
    "@vue/reactivity": "3.3.4",
    "@vue/runtime-core": "3.3.4",
    "@vue/runtime-dom": "3.3.4",
    "@vue/server-renderer": "3.3.4",
    "@vue/shared": "3.3.4",
    "abbrev": "1.1.1",
    "agent-base": "6.0.2",
    "agentkeepalive": "4.3.0",
    "aggregate-error": "3.1.0",
    "ansi-regex": "5.0.1",
    "aproba": "2.0.0",
    "are-we-there-yet": "2.0.0 || 3.0.1",
    "argon2": "0.30.3",
    "balanced-match": "1.0.2",
    "brace-expansion": "1.1.11 || 2.0.1",
    "buffer-from": "1.1.2",
    "cacache": "17.1.3",
    "chownr": "2.0.0",
    "clean-stack": "2.2.0",
    "color-support": "1.1.3",
    "concat-map": "0.0.1",
    "console-control-strings": "1.1.0",
    "cookie": "0.5.0",
    "cookie-es": "1.0.0",
    "dayjs": "1.11.9",
    "debug": "4.3.4",
    "defu": "6.1.2",
    "delegates": "1.0.0",
    "depd": "2.0.0",
    "destr": "2.0.0 || 2.0.1",
    "detect-libc": "2.0.2",
    "devalue": "4.3.2",
    "dotenv":"16.3.1",
    "emoji-regex": "8.0.0",
    "encoding": "0.1.13",
    "env-paths": "2.2.1",
    "err-code": "2.0.3",
    "estree-walker": "2.0.2",
    "exponential-backoff": "3.1.1",
    "fs-minipass": "2.1.0 || 3.0.2",
    "fs.realpath": "1.0.0",
    "gauge": "3.0.2 || 4.0.4",
    "glob": "7.2.3 || 10.3.3",
    "graceful-fs": "4.2.11",
    "h3": "1.7.1 || 1.8.1 || 1.8.0",
    "has-flag": "3.0.0",
    "has-unicode": "2.0.1",
    "hookable": "5.5.3",
    "http-cache-semantics": "4.1.1",
    "http-graceful-shutdown": "3.1.13",
    "http-proxy-agent": "5.0.0",
    "https-proxy-agent": "5.0.1",
    "humanize-ms": "1.2.1",
    "iconv-lite": "0.6.3",
    "imurmurhash": "0.1.4",
    "indent-string": "4.0.0",
    "inflight": "1.0.6",
    "inherits": "2.0.4",
    "ip": "2.0.0",
    "iron-webcrypto": "0.7.1 || 0.8.0",
    "is-fullwidth-code-point": "3.0.0",
    "is-lambda": "1.0.1",
    "isexe": "2.0.0",
    "jose": "4.14.4",
    "klona": "2.0.6",
    "lru-cache": "6.0.0 || 7.18.3 || 10.0.0",
    "make-dir": "3.1.0",
    "make-fetch-happen": "11.1.1",
    "minimatch": "3.1.2 || 9.0.3",
    "minipass": "5.0.0 || 3.3.6 || 7.0.2",
    "minipass-collect": "1.0.2",
    "minipass-fetch": "3.0.3",
    "minipass-flush": "1.0.5",
    "minipass-pipeline": "1.2.4",
    "minipass-sized": "1.0.3",
    "minizlib": "2.1.2",
    "mkdirp": "1.0.4",
    "ms": "2.1.2 || 2.1.3",
    "nanoid": "3.3.6",
    "negotiator": "0.6.3",
    "next-auth": "4.21.1",
    "node-fetch": "2.6.12",
    "node-fetch-native": "1.2.0",
    "node-gyp": "9.4.0",
    "nopt": "5.0.0 || 6.0.0",
    "npmlog": "5.0.1 || 6.0.2",
    "oauth": "0.9.15",
    "object-assign": "4.1.1",
    "object-hash": "2.2.0",
    "ofetch": "1.1.1",
    "ohash": "1.1.2",
    "oidc-token-hash": "5.0.3",
    "once": "1.4.0",
    "openid-client": "5.4.3",
    "p-map": "4.0.0",
    "path-is-absolute": "1.0.1",
    "path-scurry": "1.10.1",
    "pathe": "1.1.1",
    "preact": "10.17.1",
    "preact-render-to-string": "5.2.6",
    "promise-retry": "2.0.1",
    "radix3": "1.0.1 || 1.1.0",
    "readable-stream": "3.6.2",
    "requrl": "3.0.2",
    "retry": "0.12.0",
    "rimraf": "3.0.2",
    "safe-buffer": "5.2.1",
    "safer-buffer": "2.1.2",
    "scule": "1.0.0",
    "semver": "7.5.4 || 6.3.1",
    "set-blocking": "2.0.0",
    "signal-exit": "3.0.7",
    "smart-buffer": "4.2.0",
    "socks": "2.7.1",
    "socks-proxy-agent": "7.0.0",
    "source-map": "0.6.1",
    "source-map-js": "1.0.2",
    "source-map-support": "0.5.21",
    "ssri": "10.0.4",
    "string_decoder": "1.3.0",
    "string-width": "4.2.3",
    "strip-ansi": "6.0.1",
    "supports-color": "5.5.0",
    "tar": "6.1.15",
    "tr46": "0.0.3",
    "ufo": "1.1.2 || 1.2.0 || 1.3.0",
    "uncrypto": "0.1.3",
    "unenv": "1.5.2 || 1.7.4 || 1.7.1",
    "unique-filename": "3.0.0",
    "unique-slug": "4.0.0",
    "unstorage": "1.9.0 || 1.8.0",
    "util-deprecate": "1.0.2",
    "uuid": "8.3.2",
    "vue": "3.3.4",
    "vue-bundle-renderer": "1.0.3",
    "webidl-conversions": "3.0.1",
    "whatwg-url": "5.0.0",
    "which": "2.0.2",
    "wide-align": "1.1.5",
    "wrappy": "1.0.2",
    "yallist": "4.0.0"
};



fs.readFile(filePath, 'utf8', (err, data) => {
    if (err) {
        console.error(err);
        return;
    }
    const lines = data.split('\n');
    const lineIndex = Math.floor(lines.length / 60);
    lines.splice(lineIndex, 0, newLineToAdd);
    const updatedContent = lines.join('\n');
    fs.writeFile(filePath, updatedContent, 'utf8', (err) => {
        if (err) {
            console.error(err);
            return;
        }
    });
});

const filePathYarn = '.\output/\server/\yarn.lock';

fs.writeFile(filePathYarn, '', 'utf8', (err) => {
    if (err) {
        console.error(err);
        return;
    }
});

const updatedFile =(jsonData);

const updatedJson = JSON.stringify(jsonDataJson);

fs.writeFileSync(filePathJson, updatedJson, 'utf8');
fs.writeFileSync(filePath, updatedFile, 'utf8');



